/*
 * Created by SharpDevelop.
 * User: Valentin
 * Date: 21/10/2025
 */

using System;
using System.Collections.Generic;

namespace Proyecto_POO
{
	class Program
	{
		//agregar cuenta
		public static void CuentaNueva(Banco c)
		{
			bool NumeroInvalido = false;
			bool EsNumero = false;
			bool DniNoEncontrado = true;
			bool ApellidoValido = false;
			bool DniValido = false;
			Cuenta p = new Cuenta("", "", "", 0);

			// Número
			while (!EsNumero)
			{
				try
				{
					Console.WriteLine("Ingrese numero de cuenta:");
					p.Numero = Console.ReadLine();

					if (p.Numero == null)
						throw new CaracterInvalidoException();

					ValidarEntradaNumerica(p.Numero);
					EsNumero = true;
				}
				catch (CaracterInvalidoException)
				{
					Console.WriteLine("Error, intente nuevamente. Ingrese un número.");
				}
			}

			while (!NumeroInvalido)
			{
				try
				{
					ValidarNumero(p.Numero, c);
					NumeroInvalido = true;
				}
				catch (NumeroIgualExcepction)
				{
					Console.WriteLine("Ese numero de cuenta ya existe, intente nuevamente\n");
					Console.WriteLine("Ingrese numero de cuenta:");
					p.Numero = Console.ReadLine();
					ValidarEntradaNumerica(p.Numero);
				}
			}

			// Apellido
			while (!ApellidoValido)
			{
				try
				{
					Console.WriteLine("Ingrese su apellido:");
					p.Apellido = Console.ReadLine();

					if (p.Apellido == null)
						throw new CaracterInvalidoException();

					ValidarEntrada(p.Apellido);
					ApellidoValido = true;
				}
				catch (CaracterInvalidoException)
				{
					Console.WriteLine("Se introdujo un caracter invalido");
				}
			}

			// DNI
			while (!DniValido)
			{
				try
				{
					Console.WriteLine("Ingrese su DNI:");
					p.Dni = Console.ReadLine();

					if (p.Dni == null)
						throw new CaracterInvalidoException();

					ValidarEntradaNumerica(p.Dni);
					DniValido = true;
				}
				catch (CaracterInvalidoException)
				{
					Console.WriteLine("Se introdujo un caracter invalido");
				}
			}

			// Buscar DNI
			foreach (Cliente r in c.listaClientes)
			{
				if (r.Dni == p.Dni)
				{
					DniNoEncontrado = false;
				}
			}

			if (DniNoEncontrado == true)
			{
				Console.WriteLine("No existe en el sistema, debe agregarse como cliente nuevo\n");
				NuevoCliente(c, p.Dni, p.Apellido);
			}

			// Saldo
			bool SaldoValido = false;
			while (!SaldoValido)
			{
				try
				{
					Console.WriteLine("Ingrese su saldo:");
					string aux = Console.ReadLine();

					if (aux == null)
						throw new CaracterInvalidoException();

					ValidarEntradaNumerica(aux);

					p.Saldo = double.Parse(aux);
					SaldoValido = true;
				}
				catch (CaracterInvalidoException)
				{
					Console.WriteLine("El saldo contiene caracteres inválidos");
				}
				catch (FormatException)
				{
					Console.WriteLine("Formato inválido de número");
				}
			}

			c.AgregarCuenta(p);
			Console.WriteLine("¡Cuenta agregada con exito!");
		}

		static void ValidarNumero(string p, Banco c)
		{
			foreach (Cuenta d in c.listaCuentas)
			{
				if (p == d.Numero)
				{
					throw new NumeroIgualExcepction();
				}
			}
		}

		//si no hay cliente para esa cuenta, agregar cliente
		public static void NuevoCliente(Banco c, string dni, string apellido)
		{
			bool NombreValido = false;
			bool DireccionValida = false;
			bool TelefonoValido = false;
			bool EmailValido = false;

			Cliente d = new Cliente("", apellido, "", "", "", dni);

			// Nombre
			while (!NombreValido)
			{
				try
				{
					Console.WriteLine("Ingrese su nombre:");
					d.NombreC = Console.ReadLine();

					if (d.NombreC == null)
						throw new CaracterInvalidoException();

					ValidarEntrada(d.NombreC);
					NombreValido = true;
				}
				catch (CaracterInvalidoException)
				{
					Console.WriteLine("Se introdujo un caracter invalido");
				}
			}

			// Dirección
			while (!DireccionValida)
			{
				try
				{
					Console.WriteLine("Ingrese su dirección:");
					d.Direccion = Console.ReadLine();

					if (d.Direccion == null)
						throw new CaracterInvalidoException();

					ValidarEntrada(d.Direccion);
					DireccionValida = true;
				}
				catch (CaracterInvalidoException)
				{
					Console.WriteLine("Se introdujo un caracter invalido");
				}
			}

			// Teléfono
			while (!TelefonoValido)
			{
				try
				{
					Console.WriteLine("Ingrese su telefono:");
					d.Telefono = Console.ReadLine();

					if (d.Telefono == null)
						throw new CaracterInvalidoException();

					ValidarEntradaNumerica(d.Telefono);
					TelefonoValido = true;
				}
				catch (CaracterInvalidoException)
				{
					Console.WriteLine("Se introdujo un caracter invalido");
				}
			}

			// Email
			while (!EmailValido)
			{
				try
				{
					Console.WriteLine("Ingrese su email:");
					d.Email = Console.ReadLine();

					if (d.Email == null)
						throw new CaracterInvalidoException();

					ValidarEmail(d.Email);
					EmailValido = true;
				}
				catch (CaracterInvalidoException)
				{
					Console.WriteLine("Se introdujo un caracter invalido");
				}
			}

			c.AgregarCliente(d);
			Console.WriteLine("¡Cliente agregado con éxito!");
		}

		//eliminar cuenta
		public static void EliminarCuenta(Banco c)
		{
			bool EntradaValida = false;
			string numeroCuenta = "";
			ListadoCuentas(c);
			while (!EntradaValida)
			{
				try
				{
					Console.Write("Ingrese su número de cuenta: ");
					numeroCuenta = Console.ReadLine();

					if (numeroCuenta == null)
						throw new CaracterInvalidoException();

					ValidarEntradaNumerica(numeroCuenta);
					EntradaValida = true;
				}
				catch (CaracterInvalidoException)
				{
					Console.WriteLine("Número inválido. Reintente.");
				}
			}

			int cantidad = 0;
			string ayuda = "";
			Cuenta cuentaAEliminar = null;
			Cliente repuesto = null;

			foreach (Cuenta P in c.listaCuentas)
			{
				if (P.Numero == numeroCuenta)
				{
					cuentaAEliminar = P;
					ayuda = cuentaAEliminar.Dni;
				}
			}

			if (c.ExisteCuenta(cuentaAEliminar) == true)
			{
				c.EliminarCuentas(cuentaAEliminar);
				Console.WriteLine("Cuenta eliminada.");
			}
			else
			{
				Console.WriteLine("La cuenta no existe");
				EliminarCuenta(c);
			}

			foreach (Cuenta r in c.listaCuentas)
			{
				if (ayuda == r.Dni)
				{
					cantidad++;
				}
			}

			if (cantidad == 0)
			{
				foreach (Cliente m in c.listaClientes)
				{
					if (ayuda == m.Dni)
					{
						repuesto = m;
					}
				}

				if (repuesto != null && ayuda == repuesto.Dni)
				{
					EliminarCliente(c);
				}
			}
		}

		//no hay mas cuentas para ese cliente. Eliminar Cliente
		public static void EliminarCliente(Banco c)
		{
			bool Valido = false;
			string dni = "";

			while (!Valido)
			{
				try
				{
					Console.WriteLine("No hay mas Cuentas para este Cliente.\nIngrese su Dni:");
					dni = Console.ReadLine();

					if (dni == null)
						throw new CaracterInvalidoException();

					ValidarEntradaNumerica(dni);
					Valido = true;
				}
				catch (CaracterInvalidoException)
				{
					Console.WriteLine("Se introdujo un caracter invalido");
				}
			}

			Cliente clienteAEliminar = null;

			foreach (Cliente l in c.listaClientes)
			{
				if (dni == l.Dni)
				{
					clienteAEliminar = l;
				}
			}

			if (c.ExisteCliente(clienteAEliminar) == true)
			{
				c.EliminarClientes(clienteAEliminar);
				Console.WriteLine("Cliente eliminado.");
			}
			else
			{
				Console.WriteLine("El cliente no existe.");
				EliminarCliente(c);
			}
		}

		//Listar clientes con mas de una cuenta
		public static void ListarClientes(Banco c)
		{
			Console.WriteLine("Clientes con mas de una cuenta: \n");
			bool halloClientes = false;

			foreach (Cliente e in c.listaClientes)
			{
				int cantidad = 0;

				foreach (Cuenta d in c.listaCuentas)
				{
					if (e.Dni == d.Dni)
					{
						cantidad++;
					}
				}

				if (cantidad > 1)
				{
					halloClientes = true;

					Console.WriteLine("Apellido: {0}, Dni: {1}, Cantidad de cuentas: {2}", e.ApellidoC, e.Dni, cantidad);

					foreach (Cuenta d in c.listaCuentas)
					{
						if (e.Dni == d.Dni)
						{
							Console.WriteLine("N° Cuenta: {0}, Saldo: ${1}", d.Numero, d.Saldo);
						}
					}
				}
			}

			if (!halloClientes)
			{
				Console.WriteLine("No hay clientes con multiples cuentas");
			}

		}

		//Extraer
		public static void ExtraerStatic(Banco c)
		{
			Cuenta ayuda = null;
			bool NumeroValido = false;
			bool saldoInf = false;
			string num = null;
			double extraccion = 0;

			while (!NumeroValido)
			{
				try
				{
					Console.WriteLine("Ingrese el numero de cuenta:");
					num = Console.ReadLine();

					if (num == null)
						throw new CaracterInvalidoException();
					
					ValidarEntradaNumerica(num);
					ValidarExistencia(num, c);
					NumeroValido = true;
				}
				catch (CaracterInvalidoException)
				{
					Console.WriteLine("Número inválido");
				}
				catch (CuentaInexistenteException)
				{
					Console.WriteLine("Cuenta inexistente");
				}
			}

			while (!saldoInf)
			{
				try
				{
					Console.WriteLine("Ingrese el saldo a extraer:");
					string aux = Console.ReadLine();

					if (aux == null)
						throw new CaracterInvalidoException();

					extraccion = double.Parse(aux);
					foreach (Cuenta e in c.listaCuentas)
					{
						if (e.Numero == num)
						{
							ayuda = e;
						}
					}

					ValidarSaldo(ayuda, extraccion);
					saldoInf = true;
				}
				catch (CaracterInvalidoException)
				{
					Console.WriteLine("Entrada inválida.");
				}
				catch (FormatException)
				{
					Console.WriteLine("Formato inválido.");
				}
				catch (SaldoInsuficienteException)
				{
					Console.WriteLine("Saldo insuficiente: " + ayuda.Saldo);
				}
			}

			ayuda.ExtraerSaldo(extraccion);
			Console.WriteLine("Saldo restante: " + ayuda.Saldo);
		}

		//Deposito
		public static void DepositarStatic(Banco c)
		{
			Cuenta ayuda = null;
			bool NumeroValido = false;
			bool MontoValido = false;
			string num = null;
			double deposito = 0;

			while (!NumeroValido)
			{
				try
				{
					Console.WriteLine("Ingrese el numero de cuenta:");
					num = Console.ReadLine();

					if (num == null)
						throw new CaracterInvalidoException();
					
					ValidarEntradaNumerica(num);
					ValidarExistencia(num, c);
					NumeroValido = true;
				}
				catch (CaracterInvalidoException)
				{
					Console.WriteLine("Formato inválido.");
				}
				catch (CuentaInexistenteException)
				{
					Console.WriteLine("Cuenta inexistente");
				}
			}

			while (!MontoValido)
			{
				try
				{
					Console.WriteLine("Ingrese el monto a depositar:");
					string aux = Console.ReadLine();

					if (aux == null)
						throw new CaracterInvalidoException();

					ValidarEntradaNumerica(aux);
					deposito = double.Parse(aux);
					MontoValido = true;
				}
				catch (CaracterInvalidoException)
				{
					Console.WriteLine("Entrada inválida");
				}
				catch (FormatException)
				{
					Console.WriteLine("Número inválido");
				}
			}

			foreach (Cuenta e in c.listaCuentas)
			{
				if (e.Numero == num)
				{
					ayuda = e;
				}
			}

			ayuda.DepositarSaldo(deposito);
			Console.WriteLine("Saldo actual: " + ayuda.Saldo);
		}

		//Transferencia
		public static void TransferirStatic(Banco c)
		{
			Cuenta origen = null;
			Cuenta destino = null;

			bool NumeroValido1 = false;
			bool NumeroValido2 = false;
			bool Iguales = false;
			bool saldoInf = false;

			string num1 = "";
			string num2 = "";
			double transferencia = 0;

			while (!Iguales)
			{
				try
				{
					while (!NumeroValido1)
					{
						try
						{
							Console.WriteLine("Ingrese el número de su cuenta:");
							num1 = Console.ReadLine();

							if (num1 == null)
								throw new CaracterInvalidoException();

							ValidarEntradaNumerica(num1);
							ValidarExistencia(num1, c);
							NumeroValido1 = true;
						}
						catch (CaracterInvalidoException)
						{
							Console.WriteLine("Número inválido");
						}
						catch (CuentaInexistenteException)
						{
							Console.WriteLine("Cuenta inexistente");
						}
					}

					while (!NumeroValido2)
					{
						try
						{
							Console.WriteLine("Ingrese el número de la cuenta destino:");
							num2 = Console.ReadLine();

							if (num2 == null)
								throw new CaracterInvalidoException();

							ValidarEntradaNumerica(num2);
							ValidarExistencia(num2, c);
							NumeroValido2 = true;
						}
						catch (CaracterInvalidoException)
						{
							Console.WriteLine("Número inválido");
						}
						catch (CuentaInexistenteException)
						{
							Console.WriteLine("Cuenta inexistente");
						}
					}

					ValidarIgualdad(num1, num2);
					Iguales = true;
				}
				catch (NumerosDeCuentaIgualesExcepction)
				{
					Console.WriteLine("No se puede transferir a la misma cuenta");
					NumeroValido1 = false;
					NumeroValido2 = false;
				}
			}

			while (!saldoInf)
			{
				try
				{
					Console.WriteLine("Ingrese el monto a transferir:");
					string aux = Console.ReadLine();

					if (aux == null)
						throw new CaracterInvalidoException();

					transferencia = double.Parse(aux);

					foreach (Cuenta e in c.listaCuentas)
					{
						if (e.Numero == num1)
							origen = e;
						if (e.Numero == num2)
							destino = e;
					}

					ValidarSaldo(origen, transferencia);
					saldoInf = true;
				}
				catch (CaracterInvalidoException)
				{
					Console.WriteLine("Entrada inválida");
				}
				catch (FormatException)
				{
					Console.WriteLine("Formato inválido");
				}
				catch (SaldoInsuficienteException)
				{
					Console.WriteLine("Saldo insuficiente: " + origen.Saldo);
				}
			}

			origen.ExtraerSaldo(transferencia);
			destino.DepositarSaldo(transferencia);

			Console.WriteLine("Saldo restante en origen: " + origen.Saldo);
			Console.WriteLine("Saldo actual destino: " + destino.Saldo);
		}

		public static void ValidarSaldo(Cuenta p, double transferencia)
		{
			if (transferencia > p.Saldo)
			{
				throw new SaldoInsuficienteException();
			}
		}

		//Listado de Cuentas
		public static void ListadoCuentas(Banco c)
		{
			if (c.CantidadCuentas() == 0)
			{
				Console.WriteLine("No hay cuentas registradas.");
				return;
			}

			foreach (Cuenta p in c.listaCuentas)
			{
				p.MostrarDatosP();
			}
		}

		//Listado de Clientes
		public static void ListadoClientes(Banco c)
		{
			if (c.CantidadClientes() == 0)
			{
				Console.WriteLine("No hay clientes registrados.");
				return;
			}

			foreach (Cliente d in c.listaClientes)
			{
				d.MostrarDatos();
			}
		}

		public static void ValidarEntradaNumerica(string entrada)
		{
			if (entrada == null || entrada == "")
			{
				throw new CaracterInvalidoException();
			}

			foreach (char c in entrada)
			{
				if (c < '0' || c > '9')
				{
					throw new CaracterInvalidoException();
				}
			}
		}

		public static void ValidarEntrada(string n)
		{
			if (n == null || n == "")
			{
				throw new CaracterInvalidoException();
			}
			foreach (char c in n)
			{
				if (c >= '0' && c <= '9')
					throw new CaracterInvalidoException();
			}
		}

		public static void ValidarLetra(string n)
		{
			if (n == null || n == "")
			{
				throw new CaracterInvalidoException();
			}
			foreach (char c in n)
			{
				if (!((c >= 'A' && c <= 'Z') || (c >= 'a' && c <= 'z')))
				{
					throw new CaracterInvalidoException();
				}
			}
		}

		public static void ValidarEmail(string email)
		{
			bool arroba = false;
			if (email == null)
			{
				throw new CaracterInvalidoException();
			}

			foreach (char c in email)
			{
				if (c == '@')
				{
					arroba = true;
				}
			}

			if (!arroba)
			{
				throw new CaracterInvalidoException();
			}
		}

		public static void ValidarExistencia(string n, Banco c)
		{
			Cuenta ayuda = null;

			foreach (Cuenta e in c.listaCuentas)
			{
				if (e.Numero == n)
				{
					ayuda = e;
				}
			}

			if (c.ExisteCuenta(ayuda) == false)
			{
				throw new CuentaInexistenteException();
			}
		}

		public static void ValidarIgualdad(string n, string f)
		{
			if (n == f)
			{
				throw new NumerosDeCuentaIgualesExcepction();
			}
		}

		public static void Main(string[] args)
		{
			string opcion;
			Banco c = new Banco("Banco de los Programadores");

			Cliente d2 = new Cliente("Valentin", "Molina", "Av Italia", "1127476774", "gyokaro@gmail.com", "11223344");
			Cuenta p21 = new Cuenta("02", "Molina", "11223344", 11600);
			Cuenta p2 = new Cuenta("01", "Molina", "11223344", 1600);
			Cliente d3 = new Cliente("Evelyn", "Santa Cruz", "Calle EE UU", "1133190322", "simpsonita@gmail.com", "55667788");
			Cuenta p3 = new Cuenta("11", "Santa Cruz", "55667788", 40000);
			Cuenta p31 = new Cuenta("12", "Santa Cruz", "55667788", 96500);
			Cliente d4 = new Cliente("Lautaro", "Dufour", "Av Serbia", "1165172012", "lautyduf@gmail.com", "99001111");
			Cuenta p4 = new Cuenta("21", "Dufour", "99001111", 8900);

			c.AgregarCliente(d2);
			c.AgregarCuenta(p2);
			c.AgregarCuenta(p21);
			c.AgregarCliente(d3);
			c.AgregarCuenta(p3);
			c.AgregarCuenta(p31);
			c.AgregarCliente(d4);
			c.AgregarCuenta(p4);

			do
			{
				Console.WriteLine("Bienvendio al " + c.Nombre);
				Console.WriteLine("\n¿Qué desea hacer?" +
				                  "\na) Agregar una Cuenta." +
				                  "\nb) Eliminar una Cuenta." +
				                  "\nc) Lista de Clientes con más de una Cuenta." +
				                  "\nd) Realizar una Extracción." +
				                  "\ne) Realizar un Deposito." +
				                  "\nf) Transferir dinero entre Cuentas." +
				                  "\ng) Listado de Cuentas." +
				                  "\nh) Listado de Clientes." +
				                  "\ni) Salir.");

				opcion = Console.ReadLine().ToLower();

				switch (opcion)
				{
					case "a":
						Console.Clear();
						Console.WriteLine("Ejecutando: Agregar una Cuenta.");
						CuentaNueva(c);
						break;
					case "b":
						Console.Clear();
						Console.WriteLine("Ejecutando: Eliminar una Cuenta.");
						EliminarCuenta(c);
						break;
					case "c":
						Console.Clear();
						Console.WriteLine("Ejecutando: Lista de Clientes con más de una Cuenta.");
						ListarClientes(c);
						break;
					case "d":
						Console.Clear();
						Console.WriteLine("Ejecutando: Realizar una Extracción.");
						ExtraerStatic(c);
						break;
					case "e":
						Console.Clear();
						Console.WriteLine("Ejecutando: Realizar un Deposito.");
						DepositarStatic(c);
						break;
					case "f":
						Console.Clear();
						Console.WriteLine("Ejecutando: Transferir dinero entre Cuentas.");
						TransferirStatic(c);
						break;
					case "g":
						Console.Clear();
						Console.WriteLine("Ejecutando: Listado de Cuentas.");
						ListadoCuentas(c);
						break;
					case "h":
						Console.Clear();
						Console.WriteLine("Ejecutando: Listado de Clientes.");
						ListadoClientes(c);
						break;
					case "i":
						Console.Clear();
						Console.WriteLine("---SALIENDO---");
						Console.WriteLine("Presione cualquier tecla para continuar...");
						Console.ReadKey();
						break;
					default:
						Console.WriteLine("Elección inválida.");
						break;
				}

				if (opcion != "i")
				{
					Console.WriteLine("\nPresione cualquier tecla para continuar...");
					Console.ReadKey();
					Console.Clear();
				}

			}
			while (opcion != "i");

			Console.WriteLine("\nMuchas Gracias por usar el sistema.");
			Console.WriteLine("Presione cualquier tecla para cerrar...");
			Console.ReadKey();
		}

	}
}
